<!doctype html>



  


<html class="theme-next pisces use-motion">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>



<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />












  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css" />




  
  
  
  

  
    
    
  

  

  

  

  

  
    
    
    <link href="//fonts.googleapis.com/css?family=Lato:300,300italic,400,400italic,700,700italic&subset=latin,latin-ext" rel="stylesheet" type="text/css">
  






<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.4.0" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=5.0.2" rel="stylesheet" type="text/css" />


  <meta name="keywords" content="Node.js http server fs 文件," />








  <link rel="shortcut icon" type="image/x-icon" href="/favicon.ico?v=5.0.2" />






<meta name="description" content="前言最近在看 Node.js v6.9.1 的官方文档，发现有点儿难啃。我认为是官方文档介绍顺序的问题（当然可能是我太笨了），它没有对 API 作适当的分类和排序，只是按照字母顺序粗暴地罗列了API，这导致文档条理不清晰，看起来比较费劲。因此，我对几个我认为比较重要的模块进行再整理分类，下面是一些笔记。（如果嫌啰嗦，直接看应用部分和总结部分即可。）
概念：fs: file systerm 文件系统">
<meta property="og:type" content="article">
<meta property="og:title" content="Node.js 学习笔记—— fs 模块">
<meta property="og:url" content="http://chulinyin.com/2016/11/08/Node.js 学习笔记——fs 模块/index.html">
<meta property="og:site_name" content="褚林银的秘密基地">
<meta property="og:description" content="前言最近在看 Node.js v6.9.1 的官方文档，发现有点儿难啃。我认为是官方文档介绍顺序的问题（当然可能是我太笨了），它没有对 API 作适当的分类和排序，只是按照字母顺序粗暴地罗列了API，这导致文档条理不清晰，看起来比较费劲。因此，我对几个我认为比较重要的模块进行再整理分类，下面是一些笔记。（如果嫌啰嗦，直接看应用部分和总结部分即可。）
概念：fs: file systerm 文件系统">
<meta property="og:updated_time" content="2016-11-25T11:11:28.000Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Node.js 学习笔记—— fs 模块">
<meta name="twitter:description" content="前言最近在看 Node.js v6.9.1 的官方文档，发现有点儿难啃。我认为是官方文档介绍顺序的问题（当然可能是我太笨了），它没有对 API 作适当的分类和排序，只是按照字母顺序粗暴地罗列了API，这导致文档条理不清晰，看起来比较费劲。因此，我对几个我认为比较重要的模块进行再整理分类，下面是一些笔记。（如果嫌啰嗦，直接看应用部分和总结部分即可。）
概念：fs: file systerm 文件系统">



<script type="text/javascript" id="hexo.configuration">
  var NexT = window.NexT || {};
  var CONFIG = {
    scheme: 'Pisces',
    sidebar: {"position":"right","display":"post"},
    fancybox: true,
    motion: true,
    duoshuo: {
      userId: '0',
      author: '博主'
    }
  };
</script>




  <link rel="canonical" href="http://chulinyin.com/2016/11/08/Node.js 学习笔记——fs 模块/"/>


  <title> Node.js 学习笔记—— fs 模块 | 褚林银的秘密基地 </title>
</head>

<body itemscope itemtype="//schema.org/WebPage" lang="zh-Hans">

  










  
  
    
  

  <div class="container one-collumn sidebar-position-right page-post-detail ">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="//schema.org/WPHeader">
      <div class="header-inner"><div class="site-meta ">
  

  <div class="custom-logo-site-title">
    <a href="/"  class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <span class="site-title">褚林银的秘密基地</span>
      <span class="logo-line-after"><i></i></span>
    </a>
  </div>
  <p class="site-subtitle">Write down my thinking</p>
</div>

<div class="site-nav-toggle">
  <button>
    <span class="btn-bar"></span>
    <span class="btn-bar"></span>
    <span class="btn-bar"></span>
  </button>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br />
            
            首页
          </a>
        </li>
      
        
        <li class="menu-item menu-item-categories">
          <a href="/categories" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-th"></i> <br />
            
            分类
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br />
            
            归档
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-tags"></i> <br />
            
            标签
          </a>
        </li>
      

      
    </ul>
  

  
</nav>

 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            

  <div id="posts" class="posts-expand">
    

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="//schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                Node.js 学习笔记—— fs 模块
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">发表于</span>
            <time itemprop="dateCreated" datetime="2016-11-08T23:36:48+08:00" content="2016-11-08">
              2016-11-08
            </time>
          </span>

          
            <span class="post-category" >
              &nbsp; | &nbsp;
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
              
                <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
                  <a href="/categories/Node-js/" itemprop="url" rel="index">
                    <span itemprop="name">Node.js</span>
                  </a>
                </span>

                
                

              
            </span>
          

          
            
              <span class="post-comments-count">
                &nbsp; | &nbsp;
                <a href="/2016/11/08/Node.js 学习笔记——fs 模块/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count ds-thread-count" data-thread-key="2016/11/08/Node.js 学习笔记——fs 模块/" itemprop="commentsCount"></span>
                </a>
              </span>
            
          

          

          
          
             <span id="/2016/11/08/Node.js 学习笔记——fs 模块/" class="leancloud_visitors" data-flag-title="Node.js 学习笔记—— fs 模块">
               &nbsp; | &nbsp;
               <span class="post-meta-item-icon">
                 <i class="fa fa-eye"></i>
               </span>
               <span class="post-meta-item-text">阅读次数 </span>
               <span class="leancloud-visitors-count"></span>
              </span>
          

          
        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        <h3 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h3><p>最近在看 Node.js v6.9.1 的官方文档，发现有点儿难啃。我认为是官方文档介绍顺序的问题（当然可能是我太笨了），它没有对 API 作适当的分类和排序，只是按照字母顺序粗暴地罗列了API，这导致文档条理不清晰，看起来比较费劲。因此，我对几个我认为比较重要的模块进行再整理分类，下面是一些笔记。（如果嫌啰嗦，直接看应用部分和总结部分即可。）</p>
<h3 id="概念："><a href="#概念：" class="headerlink" title="概念："></a>概念：</h3><p>fs: file systerm 文件系统。</p>
<p>POSIX: Portable Operating System Interface of UNIX ，UNIX 的可移植性操作系统接口。</p>
<p>stream: 在计算机科学中，一个stream是一个随时间推移提供的数据元素的序列。一个 stream 可以被认为是一个传送带上一次处理一个而不是大批量的物品，在Unix以及相关基于 C 语言的系统中，一个 stream 是一个数据源或数据库，通常是单个字节或字符。 Streams 是当读取或写入文件，或在网络套接字上通信时通信的抽象使用。标准 streams是提供给所有程序的 3 位 stream 。（在计算机编程中，<a href="https://en.wikipedia.org/wiki/Standard_streams" target="_blank" rel="external">标准 streams</a> 是，当一个电脑程序开始执行时，预连接程序和它的环境之间的输入输出通信通道。三个输出输入连接被称为：标准输入、标准输出、标准错误。）</p>
<p>fd: file descriptor 文件描述符，是一个整数。</p>
<p><code>fs.appendFile()</code> 和 <code>fs.writeFile()</code> 的区别：append 是在文件末尾开始写入，而 write 是将原来的内容删除后从头开始写入。</p>
<h3 id="起步"><a href="#起步" class="headerlink" title="起步"></a>起步</h3><p>引用该模块：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">const</span> fs = <span class="built_in">require</span>(<span class="string">'fs'</span>);</div></pre></td></tr></table></figure>
<p>该模块的输入输出口基本上是 POSIX 文件操作命令的简单包装，且几乎所有方法有同步和异步两种模式。一般异步方法是 <code>fs.xxx(... , callback)</code> ，同步方法是 <code>fs.xxxSync(…)</code> 。</p>
<a id="more"></a>
<h3 id="fs模块中的属性"><a href="#fs模块中的属性" class="headerlink" title="fs模块中的属性"></a>fs模块中的属性</h3><p>无</p>
<h3 id="fs模块中的方法"><a href="#fs模块中的方法" class="headerlink" title="fs模块中的方法"></a>fs模块中的方法</h3><h4 id="流"><a href="#流" class="headerlink" title="流"></a>流</h4><ul>
<li>fs.createReadStream(path[, options]) 无同步</li>
<li>fs.createWriteStream(path[,options]) 无同步</li>
</ul>
<h5 id="fs-createReadStream-path-options"><a href="#fs-createReadStream-path-options" class="headerlink" title="fs.createReadStream(path[, options])"></a>fs.createReadStream(path[, options])</h5><p>options: Object</p>
<ul>
<li>flags: ‘r’</li>
<li>encoding: null</li>
<li>mode: 0o666 ，是权限值。</li>
<li>autoClose: true</li>
</ul>
<p>常用于打开<strong>大型</strong>的文本文件，创建一个读取操作的数据流。大型文本文件，指文本文件的体积很大，读取操作的缓存装不下，只能分成几次发送的文件。每次发送会触发一个data事件，发送结束会触发end事件。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> remaining = <span class="string">''</span>;</div><div class="line"></div><div class="line"><span class="keyword">var</span> input = fs.createReadStream(<span class="string">'line.txt'</span>);</div><div class="line"></div><div class="line">input.on(<span class="string">'data'</span>, (data) =&gt; &#123;</div><div class="line">  remaining += data;</div><div class="line">&#125;);</div><div class="line"></div><div class="line">input.on(<span class="string">'end'</span>, () =&gt; &#123;</div><div class="line">  <span class="built_in">console</span>.log(<span class="string">'Line: '</span>+ remaining);</div><div class="line">&#125;)</div></pre></td></tr></table></figure>
<h5 id="fs-createWriteStream-path-options"><a href="#fs-createWriteStream-path-options" class="headerlink" title="fs.createWriteStream(path[, options])"></a>fs.createWriteStream(path[, options])</h5><p>创建一个写入数据流对象，该对象的write方法用于写入数据，end方法用于结束写入操作。改方法与fs.createReadStream()结合，可以实现拷贝大型文件。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// 将 filename1 中的数据打开后写入到 filename2 中</span></div><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">fileCopy</span>(<span class="params">filename1, filename2, done</span>)</span>&#123;</div><div class="line">  </div><div class="line">  <span class="keyword">var</span> input = fs.createReadStream(filename1);</div><div class="line">  <span class="keyword">var</span> output = fs.createWriteStream(filename2);</div><div class="line">  </div><div class="line">  input.on(<span class="string">'data'</span>, (d) =&gt; &#123; ouput.write(d); &#125;);</div><div class="line">  input.on(<span class="string">'error'</span>, (error) =&gt; &#123; <span class="keyword">throw</span> err; &#125;);</div><div class="line">  input.on(<span class="string">'end'</span>, ()&#123;</div><div class="line">    output.end();</div><div class="line">  	<span class="keyword">if</span>(done) done();</div><div class="line">  &#125;);</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h4 id="目录"><a href="#目录" class="headerlink" title="目录"></a>目录</h4><ul>
<li>fs.mkdir(path[, mode], callback)</li>
<li>fs.readdir(path, callback)</li>
<li>fs.rmdir(path, callback)</li>
</ul>
<h5 id="fs-mkdir-path-mode-callback"><a href="#fs-mkdir-path-mode-callback" class="headerlink" title="fs.mkdir(path[, mode], callback)"></a>fs.mkdir(path[, mode], callback)</h5><p>用于新建目录。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">fs.mkdir(<span class="string">'./helloDir'</span>, <span class="number">0777</span>, <span class="function"><span class="keyword">function</span>(<span class="params">err</span>)</span>&#123;</div><div class="line">  <span class="keyword">if</span>(err) <span class="keyword">throw</span> err;</div><div class="line">&#125;);</div><div class="line"><span class="comment">// 0777为权限值</span></div></pre></td></tr></table></figure>
<h5 id="fs-readdir-path-callback"><a href="#fs-readdir-path-callback" class="headerlink" title="fs.readdir(path, callback)"></a>fs.readdir(path, callback)</h5><p>用于读取目录。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line">fs.readdir(process.cwd(), (err, files) =&gt; &#123;</div><div class="line">  files.forEach( <span class="function">(<span class="params">filename</span>) =&gt;</span> &#123;</div><div class="line">  	<span class="comment">//....</span></div><div class="line">  &#125;);        </div><div class="line">&#125;);</div><div class="line"></div><div class="line"><span class="comment">// 同步：</span></div><div class="line"><span class="keyword">var</span> files = fs.readdirSync(dir);</div><div class="line">files.forEach( <span class="function">(<span class="params">filename</span>) =&gt;</span> &#123;</div><div class="line">  <span class="comment">//....</span></div><div class="line">&#125;)</div></pre></td></tr></table></figure>
<h5 id="fs-rmdir-path-callback"><a href="#fs-rmdir-path-callback" class="headerlink" title="fs.rmdir(path, callback)"></a>fs.rmdir(path, callback)</h5><p>用于删除一个必须是空的目录。</p>
<h4 id="统计"><a href="#统计" class="headerlink" title="统计"></a>统计</h4><ul>
<li>fs.stat(path, callback)</li>
<li>fs.fstat(fd, callback)</li>
<li>fs.lstat(path, callback)</li>
</ul>
<h5 id="fs-stat-path-callback"><a href="#fs-stat-path-callback" class="headerlink" title="fs.stat(path, callback)"></a>fs.stat(path, callback)</h5><p>callback:</p>
<ul>
<li>err</li>
<li>stat: fs.Stats  对象的实例</li>
</ul>
<h4 id="监听"><a href="#监听" class="headerlink" title="监听"></a>监听</h4><ul>
<li>fs.watch(filename[, options]{, listener}) 无同步</li>
<li>fs.watchFile(filename[, options], listener) 无同步</li>
<li>fs.unwatchFile(filename[, listener]) 无同步</li>
</ul>
<h5 id="fs-watch-filename-options-listener"><a href="#fs-watch-filename-options-listener" class="headerlink" title="fs.watch(filename[, options]{, listener})"></a>fs.watch(filename[, options]{, listener})</h5><p>options: 对象</p>
<ul>
<li>perisitent: 布尔，默认 true 。表示只要文件被监视，进程是否应该继续运行。</li>
<li>recursive: 布尔，默认 false 。表示所有子目录是否应该被监视，还是仅当前目录。（仅支持 OSX 和 Windows ）</li>
</ul>
<p>listener: 回调函数</p>
<ul>
<li>event:  ‘rename’ 或者 ‘change’</li>
<li>filename: 触发事件的文件名，仅在 Linux 和 Windows 上支持。</li>
</ul>
<blockquote>
<p>注意：该方法并不是完全跨平台兼容的，在某些情况下是不可用。你可以使用 fs.watchFile ，它使用轮询统计，但是更慢更不可靠。</p>
</blockquote>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">fs.watch(<span class="string">'somedir'</span>, (event, filename) =&gt; &#123;</div><div class="line">  <span class="built_in">console</span>.log(<span class="string">`event is: <span class="subst">$&#123;event&#125;</span>`</span>);</div><div class="line">  <span class="keyword">if</span> (filename) &#123;</div><div class="line">    <span class="built_in">console</span>.log(<span class="string">`filename provided: <span class="subst">$&#123;filename&#125;</span>`</span>);</div><div class="line">  &#125; <span class="keyword">else</span> &#123;</div><div class="line">    <span class="built_in">console</span>.log(<span class="string">'filename not provided'</span>);</div><div class="line">  &#125;</div><div class="line">&#125;);</div></pre></td></tr></table></figure>
<blockquote>
<p>该方法比 fs.watchFile() 和 fs.unwatchFile() 更高效，因此尽可能使用该方法。</p>
</blockquote>
<h5 id="fs-watchFile-filename-options-listener"><a href="#fs-watchFile-filename-options-listener" class="headerlink" title="fs.watchFile(filename[, options], listener)"></a>fs.watchFile(filename[, options], listener)</h5><p>监听filname上的变化，每次文件被访问都会调用 listenter 函数。</p>
<p>options: 对象</p>
<ul>
<li>persistent: 布尔，默认 true 。表示只要文件被监视，进程是否应该继续运行。</li>
<li>interval: 数字，默认为 5007 。表示一毫秒内目标应该被轮询多少次。</li>
</ul>
<p>listener: 回调函数</p>
<ul>
<li>cur: stat 对象，表示当前统计。</li>
<li>pre: stat 对象，表示上次统计。</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">fs.watchFile(<span class="string">'message.text'</span>, (curr, prev) =&gt; &#123;</div><div class="line">  <span class="built_in">console</span>.log(<span class="string">`the current mtime is: <span class="subst">$&#123;curr.mtime&#125;</span>`</span>);</div><div class="line">  <span class="built_in">console</span>.log(<span class="string">`the previous mtime was: <span class="subst">$&#123;prev.mtime&#125;</span>`</span>);</div><div class="line">&#125;);</div></pre></td></tr></table></figure>
<h5 id="fs-unwatchFile-filename-listener"><a href="#fs-unwatchFile-filename-listener" class="headerlink" title="fs.unwatchFile(filename[,listener])"></a>fs.unwatchFile(filename[,listener])</h5><p>停止监听 filename 的变化。如果 listener 被指定了， 仅仅那个特定的监听器会被移除。否则， 所有监听器都会被移除，你已经有效地停止监听 filename 。</p>
<h4 id="访问"><a href="#访问" class="headerlink" title="访问"></a>访问</h4><ul>
<li>fs.access(path[,mode],callback)  </li>
</ul>
<h5 id="fs-access-path-mode-callback"><a href="#fs-access-path-mode-callback" class="headerlink" title="fs.access(path[,mode],callback)"></a>fs.access(path[,mode],callback)</h5><p>测试用户对指定文件的权限</p>
<p>mode:</p>
<ul>
<li>fs.F_OK，文件是调用进程可见的。可用于确定一个文件是否存在</li>
<li>fs.R_OK， 文件可通过调用进程读取</li>
<li>fs.W_OK</li>
<li>fs.X_OK，文件可通过调用进程执行。在Windows上无效（将会表现得像fs.F_OK）</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">fs.access(<span class="string">'/etc/passwd'</span>, fs.R_OK | fs.W_OK, (err)=&gt;&#123;</div><div class="line">  <span class="built_in">console</span>.log(err ? <span class="string">'no access!'</span> : <span class="string">'can read/write'</span>);</div><div class="line">&#125;)</div></pre></td></tr></table></figure>
<h4 id="打开模式"><a href="#打开模式" class="headerlink" title="打开模式"></a>打开模式</h4><ul>
<li>fs.open(path, flags[, mode], callback)</li>
</ul>
<h5 id="fs-open-path-flags-mode-callback"><a href="#fs-open-path-flags-mode-callback" class="headerlink" title="fs.open(path, flags[, mode], callback)"></a>fs.open(path, flags[, mode], callback)</h5><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">fs.open(<span class="string">'/path/to/file'</span>, <span class="string">'r'</span>, <span class="function"><span class="keyword">function</span>(<span class="params">err, fd</span>)</span>&#123;&#125;);</div></pre></td></tr></table></figure>
<p>flags:</p>
<ul>
<li>‘r’: 打开文件，用于读。如果文件不存在，发生异常。</li>
<li>‘rs’: 打开文件，用于在同步模式下读。指示操作系统绕过本地系统缓存。</li>
<li>‘r+’: 打开文件，用于读写。如果文件不存在，发生异常。</li>
<li>‘rs+’: 打开文件，用于在同步模式下读写。</li>
<li>‘w’: 打开文件，用于写。如果文件不存在，则新建；存在，则截断。</li>
<li>‘w+’: 打开文件，用于读写。如果文件不存在，则新建；存在，则截断。</li>
<li>‘wx’: 像 ‘w’，但如果 path 不存在，则失败。</li>
<li>‘a’: 打开文件，用于在尾部插入数据。如果文件不存在，则新建。</li>
<li>‘a+’: 打开文件，用于读和在尾部插入数据 。如果文件不存在，则新建。</li>
<li>‘ax’: 像 a，但如果 path 不存在，则失败。</li>
<li>‘ax+’: 像 ‘a+’，但如果 path 不存在，则失败。</li>
</ul>
<h4 id="读取"><a href="#读取" class="headerlink" title="读取"></a>读取</h4><ul>
<li>fs.read(fd, buffer, offset, length, position, callback)</li>
<li>fs.readFile(file[,options], callback)</li>
</ul>
<h5 id="fs-read-fd-buffer-offset-length-position-callback"><a href="#fs-read-fd-buffer-offset-length-position-callback" class="headerlink" title="fs.read(fd,buffer,offset,length,position,callback)"></a>fs.read(fd,buffer,offset,length,position,callback)</h5><p>从用 fd 指定的文件中读取数据</p>
<ul>
<li>fd: 数字，整数文件描述符</li>
<li>buffer: 数据将会被写入的缓存</li>
</ul>
<ul>
<li>position: 整数，指定从文件哪里开始读，如果是null，则数据将从当前文件位置开始读。</li>
<li>callback(err, bytesRead, buffer)</li>
</ul>
<h5 id="fs-readFile-file-options-callback"><a href="#fs-readFile-file-options-callback" class="headerlink" title="fs.readFile(file[,options], callback)"></a>fs.readFile(file[,options], callback)</h5><p>options:</p>
<ul>
<li>encoding: 默认为null</li>
<li>flag: 默认为’r’</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// buffer 是代表文件内容的实例</span></div><div class="line">fs.readFile(<span class="string">'img.png'</span>,  (error, buffer)=&gt;&#123;</div><div class="line">  <span class="keyword">if</span>(err) <span class="keyword">throw</span> err;</div><div class="line">  process(buffer);</div><div class="line">&#125;);</div><div class="line"></div><div class="line"><span class="keyword">var</span> text = fs.readFileSync(fileName,<span class="string">'utf8'</span>);</div><div class="line">text.split(<span class="regexp">/\r?\n/</span>).forEach(<span class="function"><span class="params">line</span>=&gt;</span>&#123;...&#125;);</div></pre></td></tr></table></figure>
<p>不同系统的行结尾字符不同：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> EOL = fileContents.indexOf(<span class="string">'\r\n'</span>) &gt;= <span class="number">0</span> ? <span class="string">'\r\n'</span> : <span class="string">'\n'</span>;</div><div class="line"></div><div class="line"><span class="keyword">var</span> EOL = (process.platform === <span class="string">'win32'</span> ? <span class="string">'\r\n'</span> : <span class="string">'\n'</span>);</div></pre></td></tr></table></figure>
<h4 id="截取"><a href="#截取" class="headerlink" title="截取"></a>截取</h4><ul>
<li>fs.truncate(path, len, callback)</li>
<li>fs.ftruncated(fd, len, callback)</li>
</ul>
<h4 id="写入"><a href="#写入" class="headerlink" title="写入"></a>写入</h4><ul>
<li>fs.write(fd, buffer, offset, length[,position], callback)</li>
<li>fs.write(fd, data[, position[, encoding]], callback)</li>
<li>fs.writeFile(file, data[,options], callback)</li>
</ul>
<ul>
<li>fs.appendFile(file, data[, options], callback) </li>
</ul>
<h5 id="fs-write-fd-buffer-offset-length-position-callback"><a href="#fs-write-fd-buffer-offset-length-position-callback" class="headerlink" title="fs.write(fd, buffer, offset, length[,position], callback)"></a>fs.write(fd, buffer, offset, length[,position], callback)</h5><p>在用fd指定的文件中写入buffer。</p>
<ul>
<li>callback(err, written, buffer)</li>
</ul>
<p>多次在同一个文件上使用该方法，没有等回调函数，会不安全。因此，推荐使用fs.createWriteStream() 。</p>
<h5 id="fs-write-fd-data-position-encoding-callback"><a href="#fs-write-fd-data-position-encoding-callback" class="headerlink" title="fs.write(fd, data[, position[, encoding]], callback)"></a>fs.write(fd, data[, position[, encoding]], callback)</h5><p>在用fd指定的文件中写入data 。如果data不是一个Buffer实例，则会被强制转换成字符串。</p>
<ul>
<li>callback(err, written, string)</li>
</ul>
<h5 id="fs-writeFile-file-data-options-callback"><a href="#fs-writeFile-file-data-options-callback" class="headerlink" title="fs.writeFile(file, data[,options], callback)"></a>fs.writeFile(file, data[,options], callback)</h5><p>在指定 file 中写入 data 。</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">fs.writeFile('fileName', 'string to write' [,encoding], (err) =&gt; &#123;</div><div class="line">  if(error) throw err;</div><div class="line">  console.log('It\'s saved!);</div><div class="line">&#125;);</div><div class="line"> </div><div class="line">// 同步：</div><div class="line">fs.writeFileSync(fileName, str, 'utf8');</div></pre></td></tr></table></figure>
<h5 id="fs-appendFile-file-data-options-callback"><a href="#fs-appendFile-file-data-options-callback" class="headerlink" title="fs.appendFile(file, data[, options], callback)"></a>fs.appendFile(file, data[, options], callback)</h5><p>将数据异步插入到文件尾部， 如果文件不存在则创建新的文件，data可以是字符串或者buffer。</p>
<p>options: Object | String</p>
<ul>
<li>encoding: String | Null， 默认为’utf8’ 。</li>
<li>mode: Number，默认为0o666 。</li>
<li>flag: String，默认为’a’ 。</li>
</ul>
<h4 id="关闭"><a href="#关闭" class="headerlink" title="关闭"></a>关闭</h4><ul>
<li>fs.close(fd, callback)</li>
</ul>
<h5 id="fs-close"><a href="#fs-close" class="headerlink" title="fs.close"></a>fs.close</h5><p>关闭一个文件描述符，这样它不再引用任何文件，并可能被重用。相关文件上持有的任何记录锁，和进程所有用的，都将被删除。（不管被曾用于获取锁的文件描述符）。</p>
<h4 id="同步"><a href="#同步" class="headerlink" title="同步"></a>同步</h4><ul>
<li>fs.fsync(fd, callback)</li>
<li>fs.fdatasync(fd, callback)</li>
</ul>
<h5 id="fs-fsync-fd-callback"><a href="#fs-fsync-fd-callback" class="headerlink" title="fs.fsync(fd, callback)"></a>fs.fsync(fd, callback)</h5><p>将文件的核心状态同存储设备同步</p>
<h5 id="fs-fdatasync-fd-callback"><a href="#fs-fdatasync-fd-callback" class="headerlink" title="fs.fdatasync(fd, callback)"></a>fs.fdatasync(fd, callback)</h5><p>与 fs.fsync(fd, callback) 类似，将文件的核心状态同存储设备同步，但不刷新修改的元数据。（除非元数据是需要的，为了允许一个附随数据回收被正确地处理。）</p>
<h3 id="fs模块中的类-构造函数"><a href="#fs模块中的类-构造函数" class="headerlink" title="fs模块中的类/构造函数"></a>fs模块中的类/构造函数</h3><ul>
<li>fs.Stats</li>
<li>fs.FSWatcher</li>
<li>fs.ReadStream</li>
<li>fs.WriteStream</li>
</ul>
<h4 id="fs-Stats"><a href="#fs-Stats" class="headerlink" title="fs.Stats"></a>fs.Stats</h4><p>从 fs.stat() 、 fs.lstat() 、 fs.fstat() 返回的对象，并且他们的异步副本也是这个类型。</p>
<h5 id="事件"><a href="#事件" class="headerlink" title="事件"></a>事件</h5><p>无</p>
<h5 id="属性"><a href="#属性" class="headerlink" title="属性"></a>属性</h5><p>一个规则的文件 util.inspect(stats) 将返回一个字符串对象，像：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div></pre></td><td class="code"><pre><div class="line">&#123;</div><div class="line">  <span class="attr">dev</span>: <span class="number">2114</span>,</div><div class="line">  <span class="attr">ino</span>: <span class="number">48064969</span>,</div><div class="line">  <span class="attr">mode</span>: <span class="number">33188</span>,</div><div class="line">  <span class="attr">nlink</span>: <span class="number">1</span>,</div><div class="line">  <span class="attr">uid</span>: <span class="number">85</span>, <span class="comment">// user identity</span></div><div class="line">  gid: <span class="number">100</span>, <span class="comment">// group identity</span></div><div class="line">  rdev: <span class="number">0</span>,</div><div class="line">  <span class="attr">size</span>: <span class="number">527</span>,</div><div class="line">  <span class="attr">blksize</span>: <span class="number">4096</span>,</div><div class="line">  <span class="attr">blocks</span>: <span class="number">8</span>,</div><div class="line">  <span class="attr">atime</span>: Mon, <span class="number">10</span> Oct <span class="number">2011</span> <span class="number">23</span>:<span class="number">24</span>:<span class="number">11</span> GMT, <span class="comment">// access time</span></div><div class="line">  mtime: Mon, <span class="number">10</span> Oct <span class="number">2011</span> <span class="number">23</span>:<span class="number">24</span>:<span class="number">11</span> GMT, <span class="comment">// modified time</span></div><div class="line">  ctime: Mon, <span class="number">10</span> Oct <span class="number">2011</span> <span class="number">23</span>:<span class="number">24</span>:<span class="number">11</span> GMT, <span class="comment">// change time</span></div><div class="line">  birthtime: Mon, <span class="number">10</span> Oct <span class="number">2011</span> <span class="number">23</span>:<span class="number">24</span>:<span class="number">11</span> GMT <span class="comment">// birth time</span></div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h5 id="方法"><a href="#方法" class="headerlink" title="方法"></a>方法</h5><p>stats:</p>
<ul>
<li>.isFile()</li>
<li>.isDirectory()</li>
<li>.isBlockDevice()</li>
<li>isCharacterDevice()</li>
<li>isSymbolicLink()，仅在fs.lstat()中有效。</li>
<li>isFIFO()</li>
<li>isSocket()</li>
</ul>
<h4 id="fs-FSWatcher"><a href="#fs-FSWatcher" class="headerlink" title="fs.FSWatcher"></a>fs.FSWatcher</h4><p>从 fs.watch() 方法返回的对象是此类型的。</p>
<h5 id="事件-1"><a href="#事件-1" class="headerlink" title="事件"></a>事件</h5><h5 id="change-改变事件"><a href="#change-改变事件" class="headerlink" title="change 改变事件"></a>change 改变事件</h5><p>当在监视目录或者文件中一些东西改变了，触发</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">fsw.on(<span class="string">'change'</span>, (event, filename)=&gt;&#123;&#125;);</div><div class="line"></div><div class="line"><span class="comment">// event: 文件改变类型</span></div></pre></td></tr></table></figure>
<h5 id="error-错误事件"><a href="#error-错误事件" class="headerlink" title="error 错误事件"></a>error 错误事件</h5><h5 id="属性-1"><a href="#属性-1" class="headerlink" title="属性"></a>属性</h5><p>无</p>
<h5 id="方法-1"><a href="#方法-1" class="headerlink" title="方法"></a>方法</h5><h5 id="watcher-close"><a href="#watcher-close" class="headerlink" title="watcher.close()"></a>watcher.close()</h5><p>停止监听给定对象上的变化。</p>
<h4 id="fs-ReadStream"><a href="#fs-ReadStream" class="headerlink" title="fs.ReadStream"></a>fs.ReadStream</h4><p>是一个可读流</p>
<h5 id="事件-2"><a href="#事件-2" class="headerlink" title="事件"></a>事件</h5><h5 id="open-打开事件"><a href="#open-打开事件" class="headerlink" title="open 打开事件"></a>open 打开事件</h5><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">function</span> (<span class="params">fd</span>) </span>&#123;&#125;</div></pre></td></tr></table></figure>
<p>当可读流的文件被打开时触发。</p>
<h5 id="close-关闭事件"><a href="#close-关闭事件" class="headerlink" title="close 关闭事件"></a>close 关闭事件</h5><p>当可读流的底层文件描述符已被 fs.close() 关闭时触发。</p>
<h5 id="属性-2"><a href="#属性-2" class="headerlink" title="属性"></a>属性</h5><h5 id="readSteam-path"><a href="#readSteam-path" class="headerlink" title="readSteam.path"></a>readSteam.path</h5><p>流读取的文件的路径。</p>
<h5 id="方法-2"><a href="#方法-2" class="headerlink" title="方法"></a>方法</h5><p>无</p>
<h4 id="fs-WriteStream"><a href="#fs-WriteStream" class="headerlink" title="fs.WriteStream"></a>fs.WriteStream</h4><p>是一个可写流</p>
<h5 id="事件-3"><a href="#事件-3" class="headerlink" title="事件"></a>事件</h5><h5 id="open-打开事件-1"><a href="#open-打开事件-1" class="headerlink" title="open 打开事件"></a>open 打开事件</h5><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">function</span> (<span class="params">fd</span>) </span>&#123;&#125;</div></pre></td></tr></table></figure>
<p>当可写流的文件被打开时触发。</p>
<h5 id="close-关闭事件-1"><a href="#close-关闭事件-1" class="headerlink" title="close 关闭事件"></a>close 关闭事件</h5><p>当可写流的底层文件描述符已被 fs.close() 关闭时触发。</p>
<h5 id="属性-3"><a href="#属性-3" class="headerlink" title="属性"></a>属性</h5><h5 id="readSteam-path-1"><a href="#readSteam-path-1" class="headerlink" title="readSteam.path"></a>readSteam.path</h5><p>流写入的文件的路径。</p>
<h5 id="writeStream-bytesWritten"><a href="#writeStream-bytesWritten" class="headerlink" title="writeStream.bytesWritten"></a>writeStream.bytesWritten</h5><p>已写入的字节数。不包括正等待被写入的数据。</p>
<h5 id="方法-3"><a href="#方法-3" class="headerlink" title="方法"></a>方法</h5><p>无</p>
<h3 id="应用"><a href="#应用" class="headerlink" title="应用"></a>应用</h3><p>应用一：读取指定路径文件的数据</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">const</span> fs = <span class="built_in">require</span>(<span class="string">'fs'</span>);</div><div class="line"></div><div class="line">fs.readFile(<span class="string">'./demo.html'</span>, (err,dataBuf) =&gt;　&#123;</div><div class="line">  <span class="keyword">if</span>(error) <span class="keyword">throw</span> err;</div><div class="line">  <span class="built_in">console</span>.log(dataBuf.toString());</div><div class="line">&#125;);</div></pre></td></tr></table></figure>
<p>应用二：创建一个服务器，当接收到 POST 请求时，将接收到的数据写入到一个文件中。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// server.js</span></div><div class="line"><span class="keyword">const</span> http = <span class="built_in">require</span>(<span class="string">'http'</span>);</div><div class="line"><span class="keyword">const</span> fs = <span class="built_in">require</span>(<span class="string">'fs'</span>);</div><div class="line"></div><div class="line"><span class="comment">// 创建服务器</span></div><div class="line"><span class="keyword">const</span> server = http.createServer(<span class="function">(<span class="params">req, res</span>) =&gt;</span> &#123;</div><div class="line">	res.writeHead(<span class="number">200</span>,<span class="string">'succeed'</span>,&#123;<span class="string">'Content-Type'</span>: <span class="string">'text/plain'</span>&#125;);</div><div class="line">	<span class="keyword">if</span>(req.method == <span class="string">'POST'</span>)&#123;</div><div class="line">      	<span class="comment">// 获取 post 请求的数据</span></div><div class="line">		<span class="keyword">var</span> postData = <span class="string">''</span>;</div><div class="line">		req.on(<span class="string">'data'</span>, (chunk) =&gt; &#123;</div><div class="line">			postData += chunk;</div><div class="line">		&#125;);</div><div class="line">		<span class="comment">// 请求结束后，将获取的数据添加到指定文件中</span></div><div class="line">		req.on(<span class="string">'end'</span>, () =&gt; &#123;</div><div class="line">			<span class="built_in">console</span>.log(<span class="string">'post requst: '</span>+postData);</div><div class="line">			fs.appendFile(<span class="string">'demo.html'</span>, postData, (err) =&gt; &#123;</div><div class="line">				<span class="keyword">if</span>(err) <span class="keyword">throw</span> err;</div><div class="line">				<span class="built_in">console</span>.log(<span class="string">'the post data has been saved in demo.html'</span>);</div><div class="line">			&#125;);</div><div class="line">            <span class="comment">// 结束响应</span></div><div class="line">			res.end(<span class="string">'accepted post request'</span>);</div><div class="line">		&#125;);</div><div class="line">	&#125;<span class="keyword">else</span>&#123;</div><div class="line">		res.end(<span class="string">'not post request'</span>);</div><div class="line">	&#125;</div><div class="line"></div><div class="line">&#125;)</div><div class="line"></div><div class="line"><span class="comment">// 启动服务器</span></div><div class="line">server.listen(<span class="number">8080</span>,() =&gt; &#123;</div><div class="line">  <span class="built_in">console</span>.log(<span class="string">'Listening on localhost:8080'</span>);</div><div class="line">&#125;);</div></pre></td></tr></table></figure>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div></pre></td><td class="code"><pre><div class="line"><span class="comment">//  post.js 用于发送测试 post 请求</span></div><div class="line"><span class="keyword">var</span> options = &#123;</div><div class="line">  <span class="attr">method</span>:<span class="string">'POST'</span>,</div><div class="line">  <span class="attr">port</span>: <span class="number">8080</span>,</div><div class="line">  <span class="attr">path</span>: <span class="string">'/'</span>,</div><div class="line">  <span class="attr">headers</span>: &#123;</div><div class="line">    <span class="string">'Content-Type'</span>: <span class="string">'application/x-www-form-urlencoded'</span>,</div><div class="line">    <span class="string">'Content-Length'</span>: Buffer.byteLength(<span class="string">'hello world'</span>)</div><div class="line">  &#125;</div><div class="line">&#125;;</div><div class="line"></div><div class="line"><span class="comment">// 创建请求</span></div><div class="line"><span class="keyword">const</span> req = http.request(options, (res) =&gt; &#123;</div><div class="line">  <span class="comment">// 存储响应返回的数据</span></div><div class="line">  <span class="keyword">var</span> buffers = [];</div><div class="line">  res.on(<span class="string">'data'</span>, (chunk) =&gt; &#123;</div><div class="line">    buffers.push(chunk);</div><div class="line">  &#125;);</div><div class="line">  </div><div class="line">  <span class="comment">// 响应结束后，打印响应返回的数据</span></div><div class="line">  res.on(<span class="string">'end'</span>, ()=&gt;&#123;</div><div class="line">    <span class="keyword">var</span> wholeData = Buffer.concat(buffers);</div><div class="line">    <span class="keyword">var</span> dataStr = wholeData.toString(<span class="string">'utf8'</span>);</div><div class="line">    <span class="built_in">console</span>.log(<span class="string">'response content:'</span> + wholeData);</div><div class="line">  &#125;)</div><div class="line">&#125;)</div><div class="line">req.on(<span class="string">'error'</span>, (e) =&gt; &#123;</div><div class="line">  <span class="built_in">console</span>.log(e.message);</div><div class="line">&#125;)</div><div class="line"><span class="comment">// 写入请求发送数据</span></div><div class="line">req.write(<span class="string">'hello world;'</span>);</div><div class="line">req.end();</div></pre></td></tr></table></figure>
<p>应用三： 读取并显示指定路径下的文件，如果是文件目录则显示目录下的所有文件（这个和本地服务器结合起来就变得很有用了）</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div><div class="line">93</div><div class="line">94</div><div class="line">95</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">const</span> http = <span class="built_in">require</span>(<span class="string">'http'</span>),</div><div class="line">	  url = <span class="built_in">require</span>(<span class="string">'url'</span>),</div><div class="line">	  fs = <span class="built_in">require</span>(<span class="string">'fs'</span>),</div><div class="line">	  path = <span class="built_in">require</span>(<span class="string">'path'</span>);</div><div class="line"></div><div class="line"><span class="keyword">const</span> server = http.createServer(<span class="function">(<span class="params">req, res</span>) =&gt;</span> &#123;</div><div class="line">	<span class="keyword">const</span> reqUrl = url.parse(req.url);</div><div class="line">	<span class="keyword">const</span> filePath = <span class="string">'.'</span>+ reqUrl.path;</div><div class="line"></div><div class="line">	<span class="comment">// 获取文件访问权限</span></div><div class="line">	fs.access(filePath, fs.F_OK | fs.R_OK, (err) =&gt; &#123;</div><div class="line">		<span class="keyword">if</span>(err)&#123;</div><div class="line">			res.writeHead(<span class="number">404</span>);</div><div class="line">			<span class="built_in">console</span>.log(err.message)</div><div class="line">			res.end();</div><div class="line">			<span class="keyword">return</span>;</div><div class="line">		&#125;</div><div class="line"></div><div class="line">		<span class="comment">// 到这里时，文件肯定可访问，</span></div><div class="line">		<span class="comment">// 因此可以用同步方法，获取文件的信息</span></div><div class="line">		<span class="keyword">const</span> stat = fs.statSync(filePath);</div><div class="line"></div><div class="line">		<span class="keyword">if</span>(stat.isFile())&#123;</div><div class="line">			<span class="keyword">const</span> type = getFileType(filePath);</div><div class="line"></div><div class="line">			res.writeHead(<span class="number">200</span>,&#123;<span class="string">'Content-Type'</span>: type&#125;);</div><div class="line">			fs.readFile(filePath, (err, chunk) =&gt; &#123;</div><div class="line">				res.write(chunk);</div><div class="line">				res.end();</div><div class="line">			&#125;);</div><div class="line"></div><div class="line">		&#125;<span class="keyword">else</span> <span class="keyword">if</span>(stat.isDirectory())&#123;</div><div class="line">			<span class="keyword">const</span> html = createHtml(filePath);</div><div class="line"></div><div class="line">			res.writeHead(<span class="number">200</span>,&#123;<span class="string">'Content-Type'</span>: <span class="string">'text/html; charset=UTF-8'</span>&#125;);</div><div class="line">			res.write(html);</div><div class="line">			res.end();</div><div class="line">		&#125;<span class="keyword">else</span>&#123;</div><div class="line">			res.writeHead(<span class="number">404</span>);</div><div class="line">			res.end(<span class="string">'please input the right url'</span>);			</div><div class="line">		&#125; </div><div class="line">	&#125;)</div><div class="line">&#125;);</div><div class="line"></div><div class="line">server.listen(<span class="number">8080</span>, () =&gt; &#123;</div><div class="line">	<span class="built_in">console</span>.log(<span class="string">'Listening at http://localhost:8080'</span>);</div><div class="line">&#125;);</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">getFileType</span>(<span class="params">filePath</span>)</span>&#123;</div><div class="line">	<span class="keyword">const</span> file = path.parse(filePath);</div><div class="line">	<span class="keyword">let</span> type = <span class="string">''</span>;</div><div class="line"></div><div class="line">	<span class="keyword">switch</span>(file.ext.slice(<span class="number">1</span>))&#123;</div><div class="line">		<span class="keyword">case</span> <span class="string">'htm'</span>:</div><div class="line">		<span class="keyword">case</span> <span class="string">'html'</span>:</div><div class="line">			type = <span class="string">'text/html; charset=UTF-8'</span>;</div><div class="line">			<span class="keyword">break</span>;</div><div class="line">		<span class="keyword">case</span> <span class="string">'css'</span>:</div><div class="line">			type = <span class="string">'text/css; charset=UTF-8'</span>;</div><div class="line">			<span class="keyword">break</span>;</div><div class="line">		<span class="keyword">case</span> <span class="string">'js'</span>:</div><div class="line">			type = <span class="string">'application/javascript; charset=UTF-8'</span>;</div><div class="line">			<span class="keyword">break</span>;</div><div class="line">		<span class="keyword">case</span> <span class="string">'txt'</span>:</div><div class="line">			type = <span class="string">'text/plain; charset=UTF-8'</span>;</div><div class="line">			<span class="keyword">break</span>;</div><div class="line">		<span class="keyword">case</span> <span class="string">'mainfest'</span>:</div><div class="line">			type = <span class="string">'text/cache-mainfest; charset=UTF-8'</span>;</div><div class="line">			<span class="keyword">break</span>;</div><div class="line">		<span class="keyword">default</span>: </div><div class="line">			type = <span class="string">'application/octet-stream'</span>;</div><div class="line">			<span class="keyword">break</span>;</div><div class="line">	&#125;</div><div class="line">	</div><div class="line">	<span class="keyword">return</span> type;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="comment">/**</span></div><div class="line"> * 输入：文件夹的路径</div><div class="line"> * 输出：html文件，其中包含当前文件夹下的所有文件的链接</div><div class="line"> */</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">createHtml</span>(<span class="params">dirPath</span>)</span>&#123;</div><div class="line">	<span class="keyword">if</span>(dirPath[dirPath.length<span class="number">-1</span>] != <span class="string">'/'</span>) dirPath += <span class="string">'/'</span>;</div><div class="line"></div><div class="line">	<span class="keyword">const</span> files = fs.readdirSync(dirPath);</div><div class="line">	</div><div class="line">	<span class="keyword">let</span> html = <span class="string">'&lt;!DOCTYPE html&gt;&lt;html lang="en"&gt;&lt;head&gt;&lt;meta charset="UTF-8"&gt;&lt;title&gt;&lt;/title&gt;&lt;/head&gt;&lt;body&gt;'</span>;</div><div class="line">	files.forEach( <span class="function">(<span class="params">fileName</span>) =&gt;</span> &#123;</div><div class="line">		html += <span class="string">`&lt;li&gt;&lt;a href=<span class="subst">$&#123;dirPath+fileName&#125;</span>&gt;<span class="subst">$&#123;fileName&#125;</span>&lt;/a&gt;&lt;/li&gt;`</span></div><div class="line">	&#125;);</div><div class="line">	html += <span class="string">'&lt;/body&gt;&lt;/html&gt;'</span></div><div class="line"></div><div class="line">	<span class="keyword">return</span> html;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>上面这个代码不是很优雅，其实可以将指定路径下的文件信息封装成一个类。另外，上面的代码再加上监听文件变化，然后实现浏览器自动刷新，那就完成一个最基本的前端本地服务环境的搭建了。（然而，我还在研究当服务器监听到项目文件变化时（这个用 <code>fs.wratch()</code> 即可实现），如何实现浏览器的自动刷新。等我研究出来了再补上吧～😁）</p>
<h3 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h3><p>这个模块提供了 js 代码与系统文件交互的接口，可以通过 <code>fs.access()</code> 读取文件访问权限（是否存在、读写），通过 <code>fs.stat()</code> 获取文件基本信息（是文件还是文件夹等），还可以通过 <code>fs.createReadStream()</code> 、 <code>fs.createWriteStream()</code>、<code>fs.readFile()</code> 、<code>fs.writeFile()</code>、<code>fs.appendFile()</code> 进行文件内容的读写操作，以及通过 <code>fs.readdir()</code> 、<code>fs.mkdir()</code>、 <code>fs.rmdir()</code> 对文件目录进行读、增、删等操作，一下子 Node.js 的疆域就开拓到了系统上。</p>
<h3 id="参考链接"><a href="#参考链接" class="headerlink" title="参考链接"></a>参考链接</h3><p><a href="https://nodejs.org/dist/latest-v6.x/docs/api/fs.html" target="_blank" rel="external">Node.js v6.9.1官方文档</a></p>
<p>阮一峰老师的<a href="http://javascript.ruanyifeng.com/nodejs/fs.html" target="_blank" rel="external">《 JavaScript 标准参考教程 (alpha) 》—— fs 模块</a></p>
<p>维基百科</p>

      
    </div>

    <div>
      
        

      
    </div>

    <div>
      
        

      
    </div>

    <footer class="post-footer">
      
        <div class="post-tags">
          
            <a href="/tags/Node-js-http-server-fs-文件/" rel="tag">#Node.js http server fs 文件</a>
          
        </div>
      

      
        <div class="post-nav">
          <div class="post-nav-next post-nav-item">
            
              <a href="/2016/11/05/遇见 MacBook Pro/" rel="next" title="遇见 MackBook Pro">
                <i class="fa fa-chevron-left"></i> 遇见 MackBook Pro
              </a>
            
          </div>

          <div class="post-nav-prev post-nav-item">
            
              <a href="/2016/11/12/Node.js 学习笔记——url querystring 模块/" rel="prev" title="Node.js 学习笔记—— url querystring 模块">
                Node.js 学习笔记—— url querystring 模块 <i class="fa fa-chevron-right"></i>
              </a>
            
          </div>
        </div>
      

      
      
    </footer>
  </article>



    <div class="post-spread">
      
    </div>
  </div>


          </div>
          


          
  <div class="comments" id="comments">
    
      <div class="ds-thread" data-thread-key="2016/11/08/Node.js 学习笔记——fs 模块/"
           data-title="Node.js 学习笔记—— fs 模块" data-url="http://chulinyin.com/2016/11/08/Node.js 学习笔记——fs 模块/">
      </div>
    
  </div>


        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    <div class="sidebar-inner">

      

      
        <ul class="sidebar-nav motion-element">
          <li class="sidebar-nav-toc sidebar-nav-active" data-target="post-toc-wrap" >
            文章目录
          </li>
          <li class="sidebar-nav-overview" data-target="site-overview">
            站点概览
          </li>
        </ul>
      

      <section class="site-overview sidebar-panel ">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="//schema.org/Person">
          <img class="site-author-image" itemprop="image"
               src="/images/avatar.jpg"
               alt="chulinyin" />
          <p class="site-author-name" itemprop="name">chulinyin</p>
          <p class="site-description motion-element" itemprop="description">褚林银的秘密基地</p>
        </div>
        <nav class="site-state motion-element">
          <div class="site-state-item site-state-posts">
            <a href="/archives">
              <span class="site-state-item-count">116</span>
              <span class="site-state-item-name">日志</span>
            </a>
          </div>

          
            <div class="site-state-item site-state-categories">
              <a href="/categories">
                <span class="site-state-item-count">13</span>
                <span class="site-state-item-name">分类</span>
              </a>
            </div>
          

          
            <div class="site-state-item site-state-tags">
              <a href="/tags">
                <span class="site-state-item-count">104</span>
                <span class="site-state-item-name">标签</span>
              </a>
            </div>
          

        </nav>

        

        <div class="links-of-author motion-element">
          
        </div>

        
        

        
        

      </section>

      
        <section class="post-toc-wrap motion-element sidebar-panel sidebar-panel-active">
          <div class="post-toc">
            
              
            
            
              <div class="post-toc-content"><ol class="nav"><li class="nav-item nav-level-3"><a class="nav-link" href="#前言"><span class="nav-number">1.</span> <span class="nav-text">前言</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#概念："><span class="nav-number">2.</span> <span class="nav-text">概念：</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#起步"><span class="nav-number">3.</span> <span class="nav-text">起步</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#fs模块中的属性"><span class="nav-number">4.</span> <span class="nav-text">fs模块中的属性</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#fs模块中的方法"><span class="nav-number">5.</span> <span class="nav-text">fs模块中的方法</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#流"><span class="nav-number">5.1.</span> <span class="nav-text">流</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#fs-createReadStream-path-options"><span class="nav-number">5.1.1.</span> <span class="nav-text">fs.createReadStream(path[, options])</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#fs-createWriteStream-path-options"><span class="nav-number">5.1.2.</span> <span class="nav-text">fs.createWriteStream(path[, options])</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#目录"><span class="nav-number">5.2.</span> <span class="nav-text">目录</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#fs-mkdir-path-mode-callback"><span class="nav-number">5.2.1.</span> <span class="nav-text">fs.mkdir(path[, mode], callback)</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#fs-readdir-path-callback"><span class="nav-number">5.2.2.</span> <span class="nav-text">fs.readdir(path, callback)</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#fs-rmdir-path-callback"><span class="nav-number">5.2.3.</span> <span class="nav-text">fs.rmdir(path, callback)</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#统计"><span class="nav-number">5.3.</span> <span class="nav-text">统计</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#fs-stat-path-callback"><span class="nav-number">5.3.1.</span> <span class="nav-text">fs.stat(path, callback)</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#监听"><span class="nav-number">5.4.</span> <span class="nav-text">监听</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#fs-watch-filename-options-listener"><span class="nav-number">5.4.1.</span> <span class="nav-text">fs.watch(filename[, options]{, listener})</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#fs-watchFile-filename-options-listener"><span class="nav-number">5.4.2.</span> <span class="nav-text">fs.watchFile(filename[, options], listener)</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#fs-unwatchFile-filename-listener"><span class="nav-number">5.4.3.</span> <span class="nav-text">fs.unwatchFile(filename[,listener])</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#访问"><span class="nav-number">5.5.</span> <span class="nav-text">访问</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#fs-access-path-mode-callback"><span class="nav-number">5.5.1.</span> <span class="nav-text">fs.access(path[,mode],callback)</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#打开模式"><span class="nav-number">5.6.</span> <span class="nav-text">打开模式</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#fs-open-path-flags-mode-callback"><span class="nav-number">5.6.1.</span> <span class="nav-text">fs.open(path, flags[, mode], callback)</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#读取"><span class="nav-number">5.7.</span> <span class="nav-text">读取</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#fs-read-fd-buffer-offset-length-position-callback"><span class="nav-number">5.7.1.</span> <span class="nav-text">fs.read(fd,buffer,offset,length,position,callback)</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#fs-readFile-file-options-callback"><span class="nav-number">5.7.2.</span> <span class="nav-text">fs.readFile(file[,options], callback)</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#截取"><span class="nav-number">5.8.</span> <span class="nav-text">截取</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#写入"><span class="nav-number">5.9.</span> <span class="nav-text">写入</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#fs-write-fd-buffer-offset-length-position-callback"><span class="nav-number">5.9.1.</span> <span class="nav-text">fs.write(fd, buffer, offset, length[,position], callback)</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#fs-write-fd-data-position-encoding-callback"><span class="nav-number">5.9.2.</span> <span class="nav-text">fs.write(fd, data[, position[, encoding]], callback)</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#fs-writeFile-file-data-options-callback"><span class="nav-number">5.9.3.</span> <span class="nav-text">fs.writeFile(file, data[,options], callback)</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#fs-appendFile-file-data-options-callback"><span class="nav-number">5.9.4.</span> <span class="nav-text">fs.appendFile(file, data[, options], callback)</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#关闭"><span class="nav-number">5.10.</span> <span class="nav-text">关闭</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#fs-close"><span class="nav-number">5.10.1.</span> <span class="nav-text">fs.close</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#同步"><span class="nav-number">5.11.</span> <span class="nav-text">同步</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#fs-fsync-fd-callback"><span class="nav-number">5.11.1.</span> <span class="nav-text">fs.fsync(fd, callback)</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#fs-fdatasync-fd-callback"><span class="nav-number">5.11.2.</span> <span class="nav-text">fs.fdatasync(fd, callback)</span></a></li></ol></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#fs模块中的类-构造函数"><span class="nav-number">6.</span> <span class="nav-text">fs模块中的类/构造函数</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#fs-Stats"><span class="nav-number">6.1.</span> <span class="nav-text">fs.Stats</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#事件"><span class="nav-number">6.1.1.</span> <span class="nav-text">事件</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#属性"><span class="nav-number">6.1.2.</span> <span class="nav-text">属性</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#方法"><span class="nav-number">6.1.3.</span> <span class="nav-text">方法</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#fs-FSWatcher"><span class="nav-number">6.2.</span> <span class="nav-text">fs.FSWatcher</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#事件-1"><span class="nav-number">6.2.1.</span> <span class="nav-text">事件</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#change-改变事件"><span class="nav-number">6.2.2.</span> <span class="nav-text">change 改变事件</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#error-错误事件"><span class="nav-number">6.2.3.</span> <span class="nav-text">error 错误事件</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#属性-1"><span class="nav-number">6.2.4.</span> <span class="nav-text">属性</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#方法-1"><span class="nav-number">6.2.5.</span> <span class="nav-text">方法</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#watcher-close"><span class="nav-number">6.2.6.</span> <span class="nav-text">watcher.close()</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#fs-ReadStream"><span class="nav-number">6.3.</span> <span class="nav-text">fs.ReadStream</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#事件-2"><span class="nav-number">6.3.1.</span> <span class="nav-text">事件</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#open-打开事件"><span class="nav-number">6.3.2.</span> <span class="nav-text">open 打开事件</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#close-关闭事件"><span class="nav-number">6.3.3.</span> <span class="nav-text">close 关闭事件</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#属性-2"><span class="nav-number">6.3.4.</span> <span class="nav-text">属性</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#readSteam-path"><span class="nav-number">6.3.5.</span> <span class="nav-text">readSteam.path</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#方法-2"><span class="nav-number">6.3.6.</span> <span class="nav-text">方法</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#fs-WriteStream"><span class="nav-number">6.4.</span> <span class="nav-text">fs.WriteStream</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#事件-3"><span class="nav-number">6.4.1.</span> <span class="nav-text">事件</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#open-打开事件-1"><span class="nav-number">6.4.2.</span> <span class="nav-text">open 打开事件</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#close-关闭事件-1"><span class="nav-number">6.4.3.</span> <span class="nav-text">close 关闭事件</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#属性-3"><span class="nav-number">6.4.4.</span> <span class="nav-text">属性</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#readSteam-path-1"><span class="nav-number">6.4.5.</span> <span class="nav-text">readSteam.path</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#writeStream-bytesWritten"><span class="nav-number">6.4.6.</span> <span class="nav-text">writeStream.bytesWritten</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#方法-3"><span class="nav-number">6.4.7.</span> <span class="nav-text">方法</span></a></li></ol></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#应用"><span class="nav-number">7.</span> <span class="nav-text">应用</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#总结"><span class="nav-number">8.</span> <span class="nav-text">总结</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#参考链接"><span class="nav-number">9.</span> <span class="nav-text">参考链接</span></a></li></ol></div>
            
          </div>
        </section>
      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright" >
  
  &copy; 
  <span itemprop="copyrightYear">2017</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">chulinyin</span>
</div>

<div class="powered-by">
  由 <a class="theme-link" href="https://hexo.io">Hexo</a> 强力驱动
</div>

<div class="theme-info">
  主题 -
  <a class="theme-link" href="https://github.com/iissnan/hexo-theme-next">
    NexT.Pisces
  </a>
</div>

        

        
      </div>
    </footer>

    <div class="back-to-top">
      <i class="fa fa-arrow-up"></i>
    </div>
  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  



  
  <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>

  
  <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>

  
  <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>

  
  <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.0.2"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.0.2"></script>



  
  


  <script type="text/javascript" src="/js/src/affix.js?v=5.0.2"></script>

  <script type="text/javascript" src="/js/src/schemes/pisces.js?v=5.0.2"></script>



  
  <script type="text/javascript" src="/js/src/scrollspy.js?v=5.0.2"></script>
<script type="text/javascript" src="/js/src/post-details.js?v=5.0.2"></script>



  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.0.2"></script>



  

  
    
  

  <script type="text/javascript">
    var duoshuoQuery = {short_name:"chulinyin"};
    (function() {
      var ds = document.createElement('script');
      ds.type = 'text/javascript';ds.async = true;
      ds.id = 'duoshuo-script';
      ds.src = (document.location.protocol == 'https:' ? 'https:' : 'http:') + '//static.duoshuo.com/embed.js';
      ds.charset = 'UTF-8';
      (document.getElementsByTagName('head')[0]
      || document.getElementsByTagName('body')[0]).appendChild(ds);
    })();
  </script>

  
    
    <script src="/lib/ua-parser-js/dist/ua-parser.min.js?v=0.7.9"></script>
    <script src="/js/src/hook-duoshuo.js"></script>
  






  
  

  

  

  
  <script src="https://cdn1.lncld.net/static/js/av-core-mini-0.6.1.js"></script>
  <script>AV.initialize("dtz5YifF8WHLzMkG3byRjSM8-gzGzoHsz", "dKrJHG1PJWQKqRRc1YrOva9E");</script>
  <script>
    function showTime(Counter) {
      var query = new AV.Query(Counter);
      var entries = [];
      var $visitors = $(".leancloud_visitors");

      $visitors.each(function () {
        entries.push( $(this).attr("id").trim() );
      });

      query.containedIn('url', entries);
      query.find()
        .done(function (results) {
          var COUNT_CONTAINER_REF = '.leancloud-visitors-count';

          if (results.length === 0) {
            $visitors.find(COUNT_CONTAINER_REF).text(0);
            return;
          }

          for (var i = 0; i < results.length; i++) {
            var item = results[i];
            var url = item.get('url');
            var time = item.get('time');
            var element = document.getElementById(url);

            $(element).find(COUNT_CONTAINER_REF).text(time);
          }
          for(var i = 0; i < entries.length; i++) {
            var url = entries[i];
            var element = document.getElementById(url);
            var countSpan = $(element).find(COUNT_CONTAINER_REF);
            if( countSpan.text() == '') {
              countSpan.text(0);
            }
          }
        })
        .fail(function (object, error) {
          console.log("Error: " + error.code + " " + error.message);
        });
    }

    function addCount(Counter) {
      var $visitors = $(".leancloud_visitors");
      var url = $visitors.attr('id').trim();
      var title = $visitors.attr('data-flag-title').trim();
      var query = new AV.Query(Counter);

      query.equalTo("url", url);
      query.find({
        success: function(results) {
          if (results.length > 0) {
            var counter = results[0];
            counter.fetchWhenSave(true);
            counter.increment("time");
            counter.save(null, {
              success: function(counter) {
                var $element = $(document.getElementById(url));
                $element.find('.leancloud-visitors-count').text(counter.get('time'));
              },
              error: function(counter, error) {
                console.log('Failed to save Visitor num, with error message: ' + error.message);
              }
            });
          } else {
            var newcounter = new Counter();
            /* Set ACL */
            var acl = new AV.ACL();
            acl.setPublicReadAccess(true);
            acl.setPublicWriteAccess(true);
            newcounter.setACL(acl);
            /* End Set ACL */
            newcounter.set("title", title);
            newcounter.set("url", url);
            newcounter.set("time", 1);
            newcounter.save(null, {
              success: function(newcounter) {
                var $element = $(document.getElementById(url));
                $element.find('.leancloud-visitors-count').text(newcounter.get('time'));
              },
              error: function(newcounter, error) {
                console.log('Failed to create');
              }
            });
          }
        },
        error: function(error) {
          console.log('Error:' + error.code + " " + error.message);
        }
      });
    }

    $(function() {
      var Counter = AV.Object.extend("Counter");
      if ($('.leancloud_visitors').length == 1) {
        addCount(Counter);
      } else if ($('.post-title-link').length > 1) {
        showTime(Counter);
      }
    });
  </script>



  

  


</body>
</html>
